{% extends "base.html" %}

{% block title %}HTTP Status Code Tester{% endblock %}

{% block header_left %}
<button class="back-to-menu" onclick="window.location.href='/menu'" title="Back to Dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Menu
</button>
{% endblock %}

{% block extra_head %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"
      id="prism-dark-theme"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"
      id="prism-light-theme" disabled/>
<link href="{{ url_for('static', filename='css/httpcodes-styles.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="httpcodes-container">
    <div class="max-width-container">
        <p class="page-description">
            This endpoint allows you to test and simulate different HTTP status codes.
            It supports multiple HTTP methods and provides useful diagnostic information
            about the request, response, and headers.
        </p>

        <!-- Sequence Endpoints Section -->
        <div class="card sequence-endpoints-card">
            <h2 class="card-title">‚ö° Sequence Endpoints</h2>
            <p class="card-description">Create powerful test sequences combining HTTP codes, delays, and custom payloads. Perfect for testing retry logic and service recovery scenarios.</p>

            <!-- Create New Sequence Endpoint Form -->
            <div class="form-section">
                <h3 class="section-title">Create New Sequence</h3>
                <form id="sequenceEndpointForm" class="endpoint-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sequenceEndpointName">Endpoint Name</label>
                            <input type="text" id="sequenceEndpointName" name="endpoint_name" required
                                placeholder="e.g., service-recovery">
                        </div>
                        <div class="form-group">
                            <label for="sequenceDescription">Description (Optional)</label>
                            <input type="text" id="sequenceDescription" name="description"
                                placeholder="e.g., Simulates service recovery with delays">
                        </div>
                    </div>

                    <!-- Sequence Steps Container -->
                    <div class="sequence-steps-container">
                        <label class="steps-label">Sequence Steps</label>
                        <div id="sequenceStepsList" class="sequence-steps-list">
                            <!-- Steps will be added dynamically here -->
                        </div>
                        <button type="button" id="addSequenceStep" class="btn btn-secondary">
                            ‚ûï Add Step
                        </button>
                    </div>

                    <button type="submit" class="btn btn-primary">Create Sequence Endpoint</button>
                </form>
            </div>

            <!-- List of Sequence Endpoints -->
            <div class="endpoints-list-section">
                <h3 class="section-title">Your Sequence Endpoints</h3>
                <div class="table-responsive">
                    <table class="sequence-table" id="sequenceEndpointsTable">
                        <thead>
                            <tr>
                                <th class="col-status">‚óè</th>
                                <th class="col-name">Endpoint</th>
                                <th class="col-sequence">Sequence</th>
                                <th class="col-progress">Current</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" class="loading-message">Loading endpoints...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üîç Endpoint</h2>
            <pre class="code-block"><code>/httpcode/&lt;int:code&gt;</code></pre>
            <p class="hint-text">Example: <code class="inline-code">/httpcode/404</code> returns a 404 Not Found
                response.</p>
        </div>

        <!-- Common Endpoint Links -->
        <div class="card">
            <h2 class="card-title">üåê Common Endpoint Links</h2>
            <p class="hint-text">Click any copy icon to copy the full endpoint URL.</p>

            <div class="endpoint-grid">
                {% set status_codes = [200, 201, 204, 301, 302, 304, 400, 401, 403, 404, 405, 422, 429, 500, 502, 503,
                504] %}
                {% for code in status_codes %}
                <div class="endpoint-item">
                    <code class="inline-code">/httpcode/{{ code }}</code>
                    <button class="copy-btn" data-url="/httpcode/{{ code }}">üìã</button>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üß† Function Description</h2>
            <p class="card-text">
                This route takes an integer <code class="inline-code">&lt;code&gt;</code> between
                <strong>100</strong> and <strong>599</strong> representing an HTTP status code.
                It returns a JSON response describing the code and request details.
            </p>
            <p class="card-text">Invalid status codes return <code class="error-code">400 Bad Request</code>.</p>
        </div>

        <div class="card">
            <h2 class="card-title">üìã Example Response</h2>
            <pre class="language-json"><code>{
  "status": 200,
  "message": "OK",
  "method": "GET",
  "path": "/httpcode/200",
  "timestamp": "2025-10-19T13:20:32Z"
}</code></pre>
        </div>

        <div class="card">
            <h2 class="card-title">üì¶ Example with Request Body (POST)</h2>
            <pre class="language-bash"><code>curl -X POST -H "Content-Type: application/json" \
-d '{"name": "Test"}' {{ request.host_url }}httpcode/201</code></pre>
            <pre class="language-json"><code>{
  "status": 201,
  "message": "Created",
  "method": "POST",
  "path": "/httpcode/201",
  "timestamp": "2025-10-19T13:21:10Z",
  "received_data": {
    "name": "Test"
  }
}</code></pre>
        </div>

        <div class="card">
            <h2 class="card-title">üß© Special Behaviors</h2>
            <ul class="special-list">
                <li><code>204</code> ‚Üí Returns an empty response (No Content)</li>
                <li><code>301 / 302 / 307 / 308</code> ‚Üí Adds a <code>Location: /</code> header</li>
                <li><code>401</code> ‚Üí Includes <code>WWW-Authenticate</code> header</li>
                <li><code>429</code> ‚Üí Includes <code>Retry-After: 60</code> header</li>
                <li><code>503</code> ‚Üí Includes <code>Retry-After: 120</code> header</li>
            </ul>
        </div>

        <div class="card">
            <h2 class="card-title">üí° Try it Live!</h2>
            <div class="test-controls">
                <input type="number" id="statusCode" min="100" max="599" value="200" class="status-input">
                <select id="httpMethod" class="method-select">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                    <option value="PATCH">PATCH</option>
                </select>
                <button onclick="testHttpCode()" class="test-button">Test Now</button>
            </div>
            <div id="testResult" class="test-result" style="display:none;"></div>
        </div>
    </div>

    <!-- Modal Component -->
    <div id="confirmModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="modal-btn modal-btn-confirm" id="modalConfirmBtn">Confirm</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Pass user_id to JavaScript
    window.userId = {{ user_id }};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
<script src="{{ url_for('static', filename='js/httpcodes.js') }}"></script>
{% endblock %}