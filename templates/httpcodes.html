{% extends "base.html" %}

{% block title %}HTTP Status Code Tester{% endblock %}

{% block header_left %}
<button class="back-to-menu" onclick="window.location.href='/menu'" title="Back to Dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Menu
</button>
{% endblock %}

{% block extra_head %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"
      id="prism-dark-theme"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"
      id="prism-light-theme" disabled/>
<link href="{{ url_for('static', filename='css/httpcodes-styles.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="httpcodes-container">
    <div class="max-width-container">
        <p class="page-description">
            This endpoint allows you to test and simulate different HTTP status codes.
            It supports multiple HTTP methods and provides useful diagnostic information
            about the request, response, and headers.
        </p>

        <!-- Special Endpoints Management Section -->
        <div class="card special-endpoints-section">
            <h2 class="card-title">‚ö° Special Endpoints - Custom Delays & HTTP Codes</h2>
            <p class="card-text">
                Create custom endpoints with specific HTTP status codes and response delays.
                These endpoints are user-specific and can be used to test timeout scenarios,
                rate limiting, and various HTTP status responses with configurable delays.
            </p>

            <!-- Create New Special Endpoint Form -->
            <div class="special-endpoint-form">
                <h3>Create New Special Endpoint</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="endpointName">Endpoint Name *</label>
                        <input type="text" id="endpointName" placeholder="e.g., slow-response" class="form-input">
                        <small class="hint-text">Use lowercase letters, numbers, and hyphens only</small>
                    </div>
                    <div class="form-group">
                        <label for="httpCode">HTTP Status Code *</label>
                        <input type="number" id="httpCode" min="100" max="599" value="200" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="delayMs">Delay (ms) *</label>
                        <input type="number" id="delayMs" min="0" value="1000" class="form-input">
                        <small class="hint-text">Response delay in milliseconds</small>
                    </div>
                    <div class="form-group full-width">
                        <label for="description">Description (Optional)</label>
                        <input type="text" id="description" placeholder="e.g., Simulate slow server response" class="form-input">
                    </div>
                    <div class="form-group full-width">
                        <label for="responsePayload">Response JSON Payload (Optional)</label>
                        <textarea id="responsePayload" placeholder='{"key": "value", "status": "success"}' class="form-input" rows="4"></textarea>
                        <small class="hint-text">Custom JSON response body. Leave empty for default response format.</small>
                    </div>
                </div>
                <button onclick="createSpecialEndpoint()" class="test-button">Create Endpoint</button>
                <div id="createMessage" class="message" style="display:none;"></div>
            </div>

            <!-- List of Special Endpoints -->
            <div class="special-endpoints-list">
                <h3>Your Special Endpoints</h3>
                <div id="endpointsTableContainer">
                    <table id="endpointsTable" class="endpoints-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Endpoint Name</th>
                                <th>HTTP Code</th>
                                <th>Delay (ms)</th>
                                <th>Description</th>
                                <th>URL</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="endpointsList">
                            <tr>
                                <td colspan="7" class="loading-message">Loading endpoints...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Rotating Endpoints Section -->
        <div class="card rotating-endpoints-section">
            <h2 class="card-title">üîÑ Rotating Endpoints - Cycle Through HTTP Codes</h2>
            <p class="card-text">
                Create endpoints that cycle through multiple HTTP status codes in sequence.
                Perfect for testing retry logic and failover scenarios.
            </p>

            <!-- Create New Rotating Endpoint Form -->
            <div class="rotating-endpoint-form">
                <h3>Create New Rotating Endpoint</h3>
                <div class="form-grid-rotating">
                    <div class="form-group">
                        <label for="rotatingEndpointName">Endpoint Name *</label>
                        <input type="text" id="rotatingEndpointName" placeholder="e.g., retry-scenario" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="httpCodesInput">HTTP Codes (comma-separated) *</label>
                        <input type="text" id="httpCodesInput" placeholder="e.g., 503,503,200" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="rotatingDescription">Description</label>
                        <input type="text" id="rotatingDescription" placeholder="Optional" class="form-input">
                    </div>
                    <div class="form-group full-width">
                        <label for="rotatingResponsePayload">Response JSON Payload (Optional)</label>
                        <textarea id="rotatingResponsePayload" placeholder='{"key": "value", "status": "success"}' class="form-input" rows="4"></textarea>
                        <small class="hint-text">Custom JSON response body. Leave empty for default response format.</small>
                    </div>
                </div>
                <button onclick="createRotatingEndpoint()" class="test-button">Create Endpoint</button>
                <div id="rotatingCreateMessage" class="message" style="display:none;"></div>
            </div>

            <!-- List of Rotating Endpoints -->
            <div class="rotating-endpoints-list">
                <h3>Your Rotating Endpoints</h3>
                <div id="rotatingEndpointsTableContainer">
                    <table id="rotatingEndpointsTable" class="endpoints-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Endpoint Name</th>
                                <th>HTTP Codes Sequence</th>
                                <th>Next Code</th>
                                <th>Description</th>
                                <th>URL</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rotatingEndpointsList">
                            <tr>
                                <td colspan="7" class="loading-message">Loading endpoints...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üîç Endpoint</h2>
            <pre class="code-block"><code>/httpcode/&lt;int:code&gt;</code></pre>
            <p class="hint-text">Example: <code class="inline-code">/httpcode/404</code> returns a 404 Not Found
                response.</p>
        </div>

        <!-- Common Endpoint Links -->
        <div class="card">
            <h2 class="card-title">üåê Common Endpoint Links</h2>
            <p class="hint-text">Click any copy icon to copy the full endpoint URL.</p>

            <div class="endpoint-grid">
                {% set status_codes = [200, 201, 204, 301, 302, 304, 400, 401, 403, 404, 405, 422, 429, 500, 502, 503,
                504] %}
                {% for code in status_codes %}
                <div class="endpoint-item">
                    <code class="inline-code">/httpcode/{{ code }}</code>
                    <button class="copy-btn" data-url="/httpcode/{{ code }}">üìã</button>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üß† Function Description</h2>
            <p class="card-text">
                This route takes an integer <code class="inline-code">&lt;code&gt;</code> between
                <strong>100</strong> and <strong>599</strong> representing an HTTP status code.
                It returns a JSON response describing the code and request details.
            </p>
            <p class="card-text">Invalid status codes return <code class="error-code">400 Bad Request</code>.</p>
        </div>

        <div class="card">
            <h2 class="card-title">üìã Example Response</h2>
            <pre class="language-json"><code>{
  "status": 200,
  "message": "OK",
  "method": "GET",
  "path": "/httpcode/200",
  "timestamp": "2025-10-19T13:20:32Z"
}</code></pre>
        </div>

        <div class="card">
            <h2 class="card-title">üì¶ Example with Request Body (POST)</h2>
            <pre class="language-bash"><code>curl -X POST -H "Content-Type: application/json" \
-d '{"name": "Test"}' {{ request.host_url }}httpcode/201</code></pre>
            <pre class="language-json"><code>{
  "status": 201,
  "message": "Created",
  "method": "POST",
  "path": "/httpcode/201",
  "timestamp": "2025-10-19T13:21:10Z",
  "received_data": {
    "name": "Test"
  }
}</code></pre>
        </div>

        <div class="card">
            <h2 class="card-title">üß© Special Behaviors</h2>
            <ul class="special-list">
                <li><code>204</code> ‚Üí Returns an empty response (No Content)</li>
                <li><code>301 / 302 / 307 / 308</code> ‚Üí Adds a <code>Location: /</code> header</li>
                <li><code>401</code> ‚Üí Includes <code>WWW-Authenticate</code> header</li>
                <li><code>429</code> ‚Üí Includes <code>Retry-After: 60</code> header</li>
                <li><code>503</code> ‚Üí Includes <code>Retry-After: 120</code> header</li>
            </ul>
        </div>

        <div class="card">
            <h2 class="card-title">üí° Try it Live!</h2>
            <div class="test-controls">
                <input type="number" id="statusCode" min="100" max="599" value="200" class="status-input">
                <select id="httpMethod" class="method-select">
                    <option value="GET">GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                    <option value="PATCH">PATCH</option>
                </select>
                <button onclick="testHttpCode()" class="test-button">Test Now</button>
            </div>
            <div id="testResult" class="test-result" style="display:none;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Pass user_id to JavaScript
    window.userId = {{ user_id }};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
<script src="{{ url_for('static', filename='js/httpcodes.js') }}"></script>
{% endblock %}