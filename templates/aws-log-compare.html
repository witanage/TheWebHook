{% extends "base.html" %}

{% block title %}AWS Log Comparison Tool{% endblock %}

{% block header_left %}
<button class="back-to-menu" onclick="window.location.href='/menu'" title="Back to Dashboard">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Menu
</button>
{% endblock %}

{% block extra_head %}
<link href="{{ url_for('static', filename='css/aws-log-compare-styles.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="aws-log-compare-container">
    <div class="page-header">
        <p class="page-description">Compare two AWS CloudWatch log exports and identify changes</p>
    </div>

    <div class="upload-section">
        <div class="upload-box" id="upload1">
            <h3>Original Log Data</h3>
            <input type="file" id="file1" accept=".csv,.tsv">
            <label for="file1" class="upload-label">Choose File</label>
            <button class="paste-btn" onclick="showPasteArea(1)">Or Paste CSV</button>
            <div class="file-name" id="fileName1"></div>
            <div class="paste-area" id="pasteArea1" style="display: none;">
                <textarea placeholder="Paste your CSV data here..." id="pasteText1"></textarea>
                <div class="paste-actions">
                    <button class="btn-small btn-apply" onclick="applyPastedData(1)">Apply</button>
                    <button class="btn-small btn-cancel" onclick="cancelPaste(1)">Cancel</button>
                </div>
            </div>
        </div>
        <div class="upload-box" id="upload2">
            <h3>New Log Data</h3>
            <input type="file" id="file2" accept=".csv,.tsv">
            <label for="file2" class="upload-label">Choose File</label>
            <button class="paste-btn" onclick="showPasteArea(2)">Or Paste CSV</button>
            <div class="file-name" id="fileName2"></div>
            <div class="paste-area" id="pasteArea2" style="display: none;">
                <textarea placeholder="Paste your CSV data here..." id="pasteText2"></textarea>
                <div class="paste-actions">
                    <button class="btn-small btn-apply" onclick="applyPastedData(2)">Apply</button>
                    <button class="btn-small btn-cancel" onclick="cancelPaste(2)">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-primary" id="compareBtn" disabled>
            Compare Logs
        </button>
        <button class="btn-secondary" id="clearBtn">
            Clear All
        </button>

        <select class="key-column-selector" id="keyColumn" title="Select the column to use as unique identifier">
            <option value="auto">üîç Auto-detect Key Column</option>
        </select>

        <div class="filter-options">
            <label class="advanced-option" title="Enable fuzzy matching to find similar records even when keys don't match exactly">
                <input type="checkbox" id="useFuzzyMatching">
                <span>üîç Fuzzy Matching</span>
            </label>
        </div>

        <div class="filter-options">
            <label>
                <input type="checkbox" id="showAdded" checked>
                <span>Added</span>
            </label>
            <label>
                <input type="checkbox" id="showRemoved" checked>
                <span>Removed</span>
            </label>
            <label>
                <input type="checkbox" id="showModified" checked>
                <span>Modified</span>
            </label>
            <label>
                <input type="checkbox" id="showUnchanged">
                <span>Unchanged</span>
            </label>
        </div>
    </div>

    <div class="stats" id="stats">
        <div class="stat-item">
            <div class="stat-value added" id="addedCount">0</div>
            <div class="stat-label">Added</div>
        </div>
        <div class="stat-item">
            <div class="stat-value removed" id="removedCount">0</div>
            <div class="stat-label">Removed</div>
        </div>
        <div class="stat-item">
            <div class="stat-value modified" id="modifiedCount">0</div>
            <div class="stat-label">Modified</div>
        </div>
        <div class="stat-item">
            <div class="stat-value unchanged" id="unchangedCount">0</div>
            <div class="stat-label">Unchanged</div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Comparing log files...</p>
    </div>

    <div class="insights" id="insights" style="display: none;"></div>

    <div class="results" id="results"></div>

    <div class="export-section" id="exportSection">
        <button class="btn-primary" id="exportBtn">
            Export Comparison Results as CSV
        </button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/aws-log-compare.js') }}"></script>
{% endblock %}

{% block about_title %}About AWS Log Comparison Tool{% endblock %}

{% block about_content %}
<section class="about-section">
    <h4>üìä AWS Log CSV Comparison Tool</h4>
    <p>Intelligent log analysis and comparison tool with AI-like capabilities for AWS CloudWatch exports and CSV data analysis.</p>
</section>

<section class="about-section">
    <h5>‚ú® Core Features</h5>
    <ul class="feature-list">
        <li><strong>File Upload or Paste</strong> - Support for CSV/TSV file upload or direct paste</li>
        <li><strong>Smart Key Detection</strong> - Advanced scoring algorithm for automatic key column identification</li>
        <li><strong>Change Tracking</strong> - Identify added, removed, modified, and fuzzy-matched entries</li>
        <li><strong>Visual Diff</strong> - Color-coded row highlighting with detailed change information</li>
        <li><strong>Statistics Dashboard</strong> - Comprehensive summary with change counts</li>
        <li><strong>Export Results</strong> - Download comparison results as CSV</li>
        <li><strong>Flexible Filtering</strong> - Show/hide different change types</li>
    </ul>
</section>

<section class="about-section">
    <h5>üß† Intelligent Analysis</h5>
    <div class="info-card">
        <strong>Fuzzy Matching (85% threshold)</strong>
        <ul style="list-style: none; padding-left: 1rem; margin-top: 0.5rem;">
            <li>‚Ä¢ Levenshtein distance algorithm for similarity</li>
            <li>‚Ä¢ Finds similar records when keys don't match exactly</li>
            <li>‚Ä¢ Shows similarity percentage for each match</li>
        </ul>
    </div>
    <div class="info-card">
        <strong>Semantic Change Detection</strong>
        <ul style="list-style: none; padding-left: 1rem; margin-top: 0.5rem;">
            <li>‚Ä¢ Numeric changes with percentage calculation</li>
            <li>‚Ä¢ Timestamp shifts with time difference</li>
            <li>‚Ä¢ Type change detection</li>
        </ul>
    </div>
    <div class="info-card">
        <strong>Pattern Detection & Data Quality</strong>
        <ul style="list-style: none; padding-left: 1rem; margin-top: 0.5rem;">
            <li>‚Ä¢ Identifies consistent change patterns</li>
            <li>‚Ä¢ Detects bulk operations</li>
            <li>‚Ä¢ Recognizes field renaming</li>
            <li>‚Ä¢ Duplicate key detection</li>
            <li>‚Ä¢ Null value analysis</li>
        </ul>
    </div>
</section>

<section class="about-section">
    <h5>üöÄ How to Use</h5>
    <ol>
        <li>Upload or paste your original log data (CSV/TSV format)</li>
        <li>Upload or paste your new log data for comparison</li>
        <li>Enable "Fuzzy Matching" if you want to find similar records with different keys</li>
        <li>Select a key column or use auto-detection (recommended)</li>
        <li>Click "Compare Logs" to start the intelligent analysis</li>
        <li>Review the insights panel for patterns, quality issues, and recommendations</li>
        <li>Use filters to focus on specific change types</li>
        <li>Export results for further analysis or documentation</li>
    </ol>
</section>

<section class="about-section">
    <h5>üé® Color Legend</h5>
    <ul class="feature-list">
        <li><strong style="color: #28a745;">Green</strong> - Added records</li>
        <li><strong style="color: #dc3545;">Red</strong> - Removed records</li>
        <li><strong style="color: #ff9800;">Orange</strong> - Modified records</li>
        <li><strong style="color: #9c27b0;">Purple</strong> - Fuzzy matched records (with similarity %)</li>
        <li><strong style="color: #007acc;">Blue</strong> - Unchanged records</li>
    </ul>
</section>

<section class="about-section">
    <p><strong>Version:</strong> 1.0</p>
</section>
{% endblock %}
